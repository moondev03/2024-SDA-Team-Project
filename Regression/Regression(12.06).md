## 마지막 업데이트
24.12.06

<br>

## 작성자
60191652 문장훈

<br>

## Hypothesis_testing 결과
위에서 작성된 T-test 결과와 Ranksum Test의 결과에서 p-value가 0.05 미만인 데이터를 집계

```python
# 선택된 특성 리스트
selected_features = selected_numeric_features + selected_nominal_features + ["hotel"]
print("=== 선택된 특성 ===")
print(selected_features)
```

```
=== 선택된 특성 ===
['lead_time', 'stays_in_weekend_nights', 'stays_in_week_nights', 'adr', 'total_of_special_requests', 'meal', 'market_segment', 'distribution_channel', 'is_repeated_guest', 'deposit_type', 'customer_type', 'arrival_date_month', 'reserved_room_type', 'hotel']
```

회귀 분석을 진행하기 전에 T-Test와 Ranksum test의 p-value가 0.05 미만이라면, 해당 독립 변수(예: 두 그룹 간 차이)가 통계적으로 유의미하다고 볼 수 있으며, 이를 회귀 모델에 포함시킬 수 있음.

그러나 회귀 모델 자체의 p-value는 회귀 계수가 0이 아닌지, 즉 독립 변수가 종속 변수에 미치는 영향이 유의미한지 평가하는 데 사용되므로, T-test와 Ranksum test의 p-value는 보조적인 역할을 사용.

<br>

## Regression Analysis
호텔 예약 가격(ADR) 예측 모델 분석

<br>

### 코드 플로우
#### 1. 데이터 로드 및 전처리
- `pandas`를 사용하여 `'hotel_bookings.csv'` 파일을 로드합니다.
- `drop()` 함수를 이용해 불필요한 열(`'agent'`, `'company'`, `'reservation_status_date'`)을 제거합니다.
- 결측값을 처리하기 위해 `fillna()` 함수로 최빈값(mode)을 이용하여 결측값을 채웁니다.

#### 2. 종속 변수와 독립 변수 설정
- `'adr'` 열을 종속 변수(`y`)로 선택하고, 나머지 열들을 독립 변수(`X`)로 설정합니다.

#### 3. 범주형 변수 인코딩
- `LabelEncoder`를 사용하여 범주형 변수들(`'hotel'`, `'meal'`, `'distribution_channel'`, `'reservation_status'`, `'country'`, 등)을 숫자형으로 변환합니다.

#### 4. 데이터 분할
- `train_test_split`을 사용해 데이터를 훈련 세트(`X_train`, `y_train`)와 테스트 세트(`X_test`, `y_test`)로 분할합니다. 테스트 데이터 비율은 20%입니다.

#### 5. 스케일링
- `StandardScaler`를 이용해 훈련 데이터와 테스트 데이터를 표준화합니다. 훈련 데이터는 `fit_transform()`으로 변환하고, 테스트 데이터는 `transform()`으로 변환합니다.

#### 6. 특성 선택
- `SelectKBest`를 사용하여 상위 20개의 특성을 선택합니다. 선택 기준은 `f_regression` 테스트입니다.
- 선택된 특성의 인덱스를 확인하고, 해당 특성의 이름을 출력합니다.

#### 7. PCA (주성분 분석) 적용
- `PCA`를 사용하여 주성분 분석을 수행하고, 설명된 분산 비율을 출력합니다. 누적 설명된 분산 비율이 95% 이상인 주성분을 선택합니다.
- `fit_transform()`을 사용하여 훈련 데이터에 대해 PCA를 수행하고, `transform()`으로 테스트 데이터도 변환합니다.

#### 8. 선형 회귀 모델 학습
- `statsmodels.api`의 `OLS` (일반 최소 제곱법)를 사용하여 선형 회귀 모델을 학습합니다.
- 모델을 훈련 데이터에 적합(fit)시킵니다.

#### 9. 예측 및 성능 평가
- 모델을 사용하여 테스트 데이터에 대한 예측을 수행합니다.
- 예측 결과를 바탕으로 `mean_squared_error`, `r2_score`를 이용해 모델의 성능을 평가합니다.
- 평균 제곱 오차(MSE), 제곱근 평균 제곱 오차(RMSE), 결정 계수(R-squared)를 출력합니다.

#### 10. 잔차 분석
- 실제 값과 예측 값의 차이인 잔차를 계산합니다.
- 잔차의 평균과 표준편차를 출력합니다.

#### 11. 모델 요약
- `results.summary()`를 사용하여 회귀 분석 결과를 출력합니다.

#### 12. 회귀 진단
- `Durbin-Watson` 검정을 통해 잔차의 자기상관을 확인합니다.

#### 13. 시각화
1. **실제 값과 예측 값 비교 산점도**: 실제 값과 예측 값의 관계를 시각화합니다.
2. **잔차 분포 히스토그램**: 잔차의 분포를 확인하기 위해 히스토그램을 그립니다.
3. **Q-Q Plot**: 잔차가 정규분포를 따르는지 확인하기 위해 Q-Q 플롯을 그립니다.
4. **잔차와 예측 값 비교 산점도**: 예측 값에 대해 잔차를 시각화하여 이상값이나 패턴을 확인합니다.

<br> 

---
<br>

## 호텔 예약 가격(ADR) 예측 모델 분석 결과

### 핵심 지표

| 구분 | 값 |
|------|-----|
| 총 특성 수 | 28개 |
| 선택된 특성 수 | 20개 |
| PCA 주성분 수 | 17개 |
| R-squared | 0.306 |
| RMSE | 52.68 |
| Durbin-Watson | 1.997 |
| 평균 잔차 | 0.1567 |

<br>

### 상위 5개 영향 변수

| 순위 | 변수명 | 중요도 점수 |
|------|---------|------------|
| 1 | reserved_room_type | 19150.17 |
| 2 | children | 12402.07 |
| 3 | assigned_room_type | 7311.53 |
| 4 | market_segment | 6020.60 |
| 5 | adults | 5907.92 |

<br>

### PCA 주요 결과

- 주성분별 누적 설명 분산비율
    - PC1: 13.77%
    - PC3: 34.71%
    - PC5: 48.51%
    - PC10: 73.31%
    - PC17: 96.46%

<br>

### 분석 결과

1. **모델 성능**
- 30.6%의 설명력은 중간 수준이며, 개선 여지가 있음
- 잔차의 정규성 가정이 위배되었으나, 자기상관성은 없음

<br>

2. **변수 영향력**
- 객실 유형(예약/배정)이 가격 결정에 가장 큰 영향
- 투숙객 구성(아동 수, 성인 수)이 그 다음으로 중요

<br>

3. **차원 축소 효과**
- 28개 변수를 17개 주성분으로 축소하여 96.46% 설명
- 처음 5개 주성분만으로도 약 50% 설명 가능

<br>

4. **개선 제안**
- 비선형 변환 고려
- 이상치 처리 방안 수립
- 추가 변수 발굴

<br>

### OLS Regression Results
```
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                    adr   R-squared:                       0.306
Model:                            OLS   Adj. R-squared:                  0.306
Method:                 Least Squares   F-statistic:                     2479.
Date:                Sat, 07 Dec 2024   Prob (F-statistic):               0.00
Time:                        00:48:18   Log-Likelihood:            -4.8810e+05
No. Observations:               95512   AIC:                         9.762e+05
Df Residuals:                   95494   BIC:                         9.764e+05
Df Model:                          17                                         
Covariance Type:            nonrobust                                         
==============================================================================
                 coef    std err          t      P>|t|      [0.025      0.975]
------------------------------------------------------------------------------
const        101.7735      0.130    784.275      0.000     101.519     102.028
x1            12.4190      0.078    158.833      0.000      12.266      12.572
x2            -2.3938      0.084    -28.641      0.000      -2.558      -2.230
x3             0.9909      0.097     10.181      0.000       0.800       1.182
x4             2.9634      0.107     27.639      0.000       2.753       3.174
x5             0.5109      0.114      4.478      0.000       0.287       0.735
x6           -10.6115      0.121    -87.869      0.000     -10.848     -10.375
x7             1.6064      0.127     12.617      0.000       1.357       1.856
x8             0.2315      0.133      1.745      0.081      -0.029       0.492
x9             5.6537      0.135     41.787      0.000       5.389       5.919
x10           -0.5575      0.138     -4.053      0.000      -0.827      -0.288
x11           -0.3927      0.143     -2.756      0.006      -0.672      -0.113
x12            7.7607      0.144     53.810      0.000       7.478       8.043
x13            0.7967      0.150      5.321      0.000       0.503       1.090
x14            2.4428      0.164     14.887      0.000       2.121       2.764
x15            6.2114      0.169     36.750      0.000       5.880       6.543
x16           -1.2628      0.173     -7.299      0.000      -1.602      -0.924
x17           -6.0414      0.191    -31.661      0.000      -6.415      -5.667
==============================================================================
Omnibus:                    16214.497   Durbin-Watson:                   1.997
Prob(Omnibus):                  0.000   Jarque-Bera (JB):            78454.315
Skew:                           0.748   Prob(JB):                         0.00
Kurtosis:                       7.180   Cond. No.                         2.44
==============================================================================
```

![alt text](./image/Actual%20vs%20Predicted.png)
![alt text](./image/Distribution%20of%20Residuals.png)
![alt text](./image/Q-Q%20Plot%20of%20Residulas.png)
![alt text](./image/Residuals%20vs%20Predicted%20Values.png)